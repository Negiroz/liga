<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal Comercial - Liga SIGMA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background: #eef2f3; 
            background: -webkit-linear-gradient(to right, #8e9eab, #eef2f3);
            background: linear-gradient(to right, #8e9eab, #eef2f3);
        }
        .header-font { font-family: 'Oswald', sans-serif; }
        .scoreboard-header { text-shadow: 2px 2px 4px rgba(0,0,0,0.2); }
        .department-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border-radius: 1.5rem;
        }
        .department-card:hover:not(.disabled) {
            transform: translateY(-10px) scale(1.05);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        .disabled {
            opacity: 0.5;
            cursor: not-allowed;
            filter: grayscale(80%);
        }
    </style>
</head>
<body class="text-gray-800">
    <div id="portal-app" class="hidden">
        <div class="container mx-auto p-4 md:p-8">
            <header class="text-center py-12 relative">
                 <div class="absolute top-4 right-4 text-right">
                     <span id="user-display" class="font-semibold"></span>
                     <button id="logout-btn" class="ml-4 text-sm bg-red-500 hover:bg-red-600 text-white font-bold py-1 px-3 rounded-full">Salir</button>
                 </div>
                 <h1 class="text-6xl md:text-7xl font-bold text-blue-800 header-font scoreboard-header">LIGA SIGMA DE CAMPEONES</h1>
                 <p class="text-gray-600 text-2xl header-font mt-2">Portal Comercial</p>
            </header>

            <main>
                <h2 class="text-center text-3xl font-semibold text-gray-700 mb-12 header-font">Selecciona tu Área</h2>
                <div id="department-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10 max-w-6xl mx-auto">
                    
                    <a href="closers.html" id="select-closers-btn" class="department-card bg-white p-8 rounded-xl shadow-lg text-center cursor-pointer block">
                        <div class="text-blue-600 mb-4"><svg xmlns="http://www.w3.org/2000/svg" class="h-24 w-24 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1"><path stroke-linecap="round" stroke-linejoin="round" d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z" /><path stroke-linecap="round" stroke-linejoin="round" d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z" /></svg></div>
                        <h3 class="text-3xl font-bold header-font text-gray-800">Closers</h3>
                        <p class="text-gray-500 mt-2">Gestión de KPIs y Rendimiento.</p>
                    </a>
                    
                    <a href="campo.html" id="select-campo-btn" class="department-card bg-white p-8 rounded-xl shadow-lg text-center cursor-pointer block">
                         <div class="text-blue-600 mb-4"><svg xmlns="http://www.w3.org/2000/svg" class="h-24 w-24 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1"><path stroke-linecap="round" stroke-linejoin="round" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" /></svg></div>
                        <h3 class="text-3xl font-bold header-font text-gray-800">Agentes de Campo</h3>
                        <p class="text-gray-500 mt-2">Métricas y seguimiento en terreno.</p>
                    </a>

                    <a href="atc.html" id="select-atc-btn" class="department-card bg-white p-8 rounded-xl shadow-lg text-center cursor-pointer block">
                         <div class="text-blue-600 mb-4"><svg xmlns="http://www.w3.org/2000/svg" class="h-24 w-24 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1"><path stroke-linecap="round" stroke-linejoin="round" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg></div>
                        <h3 class="text-3xl font-bold header-font text-gray-800">Atención al Cliente</h3>
                        <p class="text-gray-500 mt-2">Indicadores de calidad y satisfacción.</p>
                    </a>
                    
                    <a href="dashboard.html" id="select-dashboard-btn" class="department-card bg-yellow-400 p-8 rounded-xl shadow-lg text-center cursor-pointer block">
                        <div class="text-gray-800 mb-4"><svg xmlns="http://www.w3.org/2000/svg" class="h-24 w-24 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" /></svg></div>
                        <h3 class="text-3xl font-bold header-font text-gray-800">Visión Gerencial</h3>
                        <p class="text-gray-700 mt-2">Rendimiento global y análisis.</p>
                    </a>

                    <a href="admin.html" id="select-admin-btn" class="department-card bg-gray-800 text-white p-8 rounded-xl shadow-lg text-center cursor-pointer block">
                        <div class="text-amber-400 mb-4"><svg xmlns="http://www.w3.org/2000/svg" class="h-24 w-24 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1"><path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg></div>
                        <h3 class="text-3xl font-bold header-font">Admin</h3>
                        <p class="text-gray-400 mt-2">Gestión de Usuarios y Sistema.</p>
                    </a>
                </div>
            </main>
        </div>
        <script>
            document.addEventListener('DOMContentLoaded', async () => {
                try {
                    const response = await fetch('api/check_session.php');
                    const session = await response.json();

                    if (!session.loggedIn) {
                        window.location.href = 'index.html'; 
                        return;
                    }
                    
                    document.getElementById('portal-app').classList.remove('hidden');
                    document.getElementById('user-display').textContent = `Bienvenido, ${session.user.username}`;
                    
                    const userRole = session.user.role;
                    const cards = {
                        'supervisor_closers': document.getElementById('select-closers-btn'),
                        'supervisor_campo': document.getElementById('select-campo-btn'),
                        'supervisor_atc': document.getElementById('select-atc-btn'),
                        'admin': [document.getElementById('select-admin-btn'), document.getElementById('select-dashboard-btn')]
                    };

                    if (userRole !== 'admin') {
                        Object.entries(cards).forEach(([role, card]) => {
                             if(role === 'admin' && Array.isArray(card)) {
                                card.forEach(c => c.classList.add('disabled'));
                             } else if (card && role !== userRole) {
                                card.classList.add('disabled');
                                if(card.tagName === 'A') {
                                    card.href = "#"; 
                                    card.addEventListener('click', e => e.preventDefault());
                                }
                            }
                        });
                    }

                } catch (e) {
                    window.location.href = 'index.html';
                }

                document.getElementById('logout-btn').addEventListener('click', async () => {
                    await fetch('api/logout.php');
                    window.location.href = 'index.html';
                });
            });
        </script>
    </body>
</html>